<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据库诊断工具 - QR码游戏系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 30px;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px 0 rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px 0 rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 30px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 30px;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px 0 rgba(255, 107, 107, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px 0 rgba(255, 107, 107, 0.6);
        }

        .status-good {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            color: #c8e6c9;
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #fff9c4;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: #ffcdd2;
        }

        .status-info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.4);
            color: #bbdefb;
        }

        .test-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .test-item.passed {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.4);
        }

        .test-item.failed {
            background: rgba(244, 67, 54, 0.2);
            border-color: rgba(244, 67, 54, 0.4);
        }

        .test-item.warning {
            background: rgba(255, 193, 7, 0.2);
            border-color: rgba(255, 193, 7, 0.4);
        }

        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 6px 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="container mx-auto px-4">
        <div class="max-w-5xl mx-auto">
            <!-- 标题卡片 -->
            <div class="glass-card p-8 mb-8 text-center">
                <h1 class="text-3xl font-bold text-white mb-4">数据库诊断工具</h1>
                <p class="text-white text-opacity-80 mb-6">全面检测和修复数据库连接及表结构问题</p>
                <div class="flex justify-center space-x-4">
                    <button id="runDiagnosticBtn" class="btn-primary">
                        <i class="fa fa-stethoscope mr-2"></i>运行诊断
                    </button>
                    <button id="fixAllBtn" class="btn-secondary" disabled>
                        <i class="fa fa-wrench mr-2"></i>一键修复
                    </button>
                </div>
            </div>

            <!-- 诊断结果卡片 -->
            <div class="glass-card p-8">
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- 左侧：测试项目 -->
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4">诊断项目</h3>
                        <div class="space-y-3" id="testItems">
                            <!-- 测试项目将在这里动态生成 -->
                        </div>
                    </div>

                    <!-- 右侧：详细日志 -->
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4">详细日志</h3>
                        <div class="log-container" id="logContainer">
                            <div class="log-entry status-info">
                                <i class="fa fa-info-circle mr-2"></i>
                                系统就绪，请点击"运行诊断"按钮开始检测
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 底部：总结和操作按钮 -->
                <div class="mt-8">
                    <div class="p-4 rounded-lg mb-6" id="summaryBox">
                        <h4 class="font-bold text-white mb-2">诊断总结</h4>
                        <p class="text-white text-opacity-80" id="summaryText">尚未运行诊断，请点击上方按钮开始。</p>
                    </div>
                    
                    <div class="flex flex-wrap justify-center gap-4">
                        <button id="exportLogBtn" class="btn-secondary" disabled>
                            <i class="fa fa-download mr-2"></i>导出日志
                        </button>
                        <button id="retryBtn" class="btn-primary" disabled>
                            <i class="fa fa-refresh mr-2"></i>重新诊断
                        </button>
                        <button id="gotoInitBtn" class="btn-secondary" disabled>
                            <i class="fa fa-database mr-2"></i>前往初始化
                        </button>
                        <button id="gotoLoginBtn" class="btn-primary" disabled>
                            <i class="fa fa-sign-in mr-2"></i>前往登录
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // 导入模块
        import './js/config.js';
        import './js/database.js';

        // 全局变量
        let db = null;
        let testResults = [];
        let isDiagnosticRunning = false;

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('数据库诊断工具加载完成');
            
            // 绑定事件
            bindEvents();
            
            // 尝试初始化数据库管理器
            try {
                db = new DatabaseManager();
                addLog('数据库管理器初始化成功', 'info');
            } catch (error) {
                addLog('数据库管理器初始化失败: ' + error.message, 'error');
            }
        });

        // 绑定事件
        function bindEvents() {
            document.getElementById('runDiagnosticBtn').addEventListener('click', runDiagnostic);
            document.getElementById('fixAllBtn').addEventListener('click', fixAllIssues);
            document.getElementById('exportLogBtn').addEventListener('click', exportLog);
            document.getElementById('retryBtn').addEventListener('click', runDiagnostic);
            document.getElementById('gotoInitBtn').addEventListener('click', () => {
                window.location.href = 'init-database.html';
            });
            document.getElementById('gotoLoginBtn').addEventListener('click', () => {
                window.location.href = 'admin-login.html';
            });
        }

        // 运行诊断
        async function runDiagnostic() {
            if (isDiagnosticRunning) return;
            
            isDiagnosticRunning = true;
            resetUI();
            addLog('开始数据库诊断...', 'info');
            
            testResults = [];
            
            // 生成测试项目
            generateTestItems();
            
            try {
                // 执行所有测试
                await runAllTests();
                
                // 生成总结
                generateSummary();
                
                // 更新按钮状态
                updateButtonStates();
                
            } catch (error) {
                addLog('诊断过程中发生错误: ' + error.message, 'error');
            } finally {
                isDiagnosticRunning = false;
            }
        }

        // 生成测试项目
        function generateTestItems() {
            const testItemsContainer = document.getElementById('testItems');
            testItemsContainer.innerHTML = '';
            
            const tests = [
                { id: 'connection', name: '数据库连接', description: '测试与Supabase的连接是否正常' },
                { id: 'admins_table', name: '管理员表', description: '检查admins表是否存在且可访问' },
                { id: 'games_table', name: '游戏表', description: '检查games表是否存在且可访问' },
                { id: 'users_table', name: '用户表', description: '检查users表是否存在且可访问' },
                { id: 'records_table', name: '记录表', description: '检查game_records表是否存在且可访问' },
                { id: 'admin_account', name: '管理员账号', description: '检查默认管理员账号是否存在' },
                { id: 'sample_data', name: '示例数据', description: '检查是否存在示例游戏和用户数据' },
                { id: 'data_integrity', name: '数据完整性', description: '检查数据之间的关联是否完整' }
            ];
            
            tests.forEach(test => {
                const testItem = document.createElement('div');
                testItem.className = 'test-item';
                testItem.id = `test-${test.id}`;
                testItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-bold text-white">${test.name}</h4>
                            <p class="text-white text-opacity-70 text-sm">${test.description}</p>
                        </div>
                        <div class="status-indicator">
                            <i class="fa fa-circle-o-notch fa-spin text-white text-opacity-50"></i>
                        </div>
                    </div>
                `;
                testItemsContainer.appendChild(testItem);
            });
        }

        // 执行所有测试
        async function runAllTests() {
            // 测试1：数据库连接
            await runTest('connection', testDatabaseConnection);
            
            // 测试2：管理员表
            await runTest('admins_table', testAdminsTable);
            
            // 测试3：游戏表
            await runTest('games_table', testGamesTable);
            
            // 测试4：用户表
            await runTest('users_table', testUsersTable);
            
            // 测试5：记录表
            await runTest('records_table', testGameRecordsTable);
            
            // 测试6：管理员账号
            await runTest('admin_account', testAdminAccount);
            
            // 测试7：示例数据
            await runTest('sample_data', testSampleData);
            
            // 测试8：数据完整性
            await runTest('data_integrity', testDataIntegrity);
        }

        // 运行单个测试
        async function runTest(testId, testFunction) {
            const testItem = document.getElementById(`test-${testId}`);
            const statusIndicator = testItem.querySelector('.status-indicator');
            
            try {
                addLog(`开始测试: ${testItem.querySelector('h4').textContent}`, 'info');
                
                const result = await testFunction();
                
                // 更新测试结果
                testResults.push({
                    id: testId,
                    name: testItem.querySelector('h4').textContent,
                    status: result.status,
                    message: result.message,
                    fixable: result.fixable || false
                });
                
                // 更新UI
                updateTestItemUI(testId, result.status, result.message);
                
                addLog(`测试结果: ${result.status.toUpperCase()} - ${result.message}`, result.status);
                
            } catch (error) {
                // 测试失败
                testResults.push({
                    id: testId,
                    name: testItem.querySelector('h4').textContent,
                    status: 'error',
                    message: error.message,
                    fixable: false
                });
                
                updateTestItemUI(testId, 'error', error.message);
                addLog(`测试失败: ${error.message}`, 'error');
            }
        }

        // 更新测试项目UI
        function updateTestItemUI(testId, status, message) {
            const testItem = document.getElementById(`test-${testId}`);
            const statusIndicator = testItem.querySelector('.status-indicator');
            
            // 移除所有状态类
            testItem.classList.remove('passed', 'failed', 'warning');
            
            // 设置状态类和图标
            let iconClass = '';
            let statusText = '';
            
            switch (status) {
                case 'success':
                    testItem.classList.add('passed');
                    iconClass = 'fa-check-circle text-green-400';
                    statusText = '通过';
                    break;
                case 'warning':
                    testItem.classList.add('warning');
                    iconClass = 'fa-exclamation-triangle text-yellow-400';
                    statusText = '警告';
                    break;
                case 'error':
                    testItem.classList.add('failed');
                    iconClass = 'fa-times-circle text-red-400';
                    statusText = '失败';
                    break;
                default:
                    iconClass = 'fa-question-circle text-gray-400';
                    statusText = '未知';
            }
            
            // 更新状态指示器
            statusIndicator.innerHTML = `
                <div class="flex items-center">
                    <i class="fa ${iconClass} mr-2"></i>
                    <span class="text-white text-opacity-90 text-sm">${statusText}</span>
                </div>
            `;
            
            // 添加消息提示
            const existingMessage = testItem.querySelector('.test-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'test-message mt-2 text-sm';
            messageDiv.textContent = message;
            testItem.appendChild(messageDiv);
        }

        // 测试1：数据库连接
        async function testDatabaseConnection() {
            try {
                const result = await db.supabase.from('information_schema.tables')
                    .select('table_name')
                    .limit(1);
                
                if (result.error) {
                    return {
                        status: 'error',
                        message: '数据库连接失败: ' + result.error.message,
                        fixable: true
                    };
                }
                
                return {
                    status: 'success',
                    message: '数据库连接正常'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '数据库连接测试异常: ' + error.message,
                    fixable: true
                };
            }
        }

        // 测试2：管理员表
        async function testAdminsTable() {
            try {
                const { data, error } = await db.supabase.from('admins').select('*').limit(1);
                
                if (error) {
                    return {
                        status: 'error',
                        message: '管理员表不存在或无法访问: ' + error.message,
                        fixable: true
                    };
                }
                
                if (!data || data.length === 0) {
                    return {
                        status: 'warning',
                        message: '管理员表存在但为空',
                        fixable: true
                    };
                }
                
                return {
                    status: 'success',
                    message: '管理员表正常'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '管理员表测试异常: ' + error.message,
                    fixable: true
                };
            }
        }

        // 测试3：游戏表
        async function testGamesTable() {
            try {
                const { data, error } = await db.supabase.from('games').select('*').limit(1);
                
                if (error) {
                    return {
                        status: 'error',
                        message: '游戏表不存在或无法访问: ' + error.message,
                        fixable: true
                    };
                }
                
                if (!data || data.length === 0) {
                    return {
                        status: 'warning',
                        message: '游戏表存在但为空',
                        fixable: true
                    };
                }
                
                return {
                    status: 'success',
                    message: '游戏表正常'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '游戏表测试异常: ' + error.message,
                    fixable: true
                };
            }
        }

        // 测试4：用户表
        async function testUsersTable() {
            try {
                const { data, error } = await db.supabase.from('users').select('*').limit(1);
                
                if (error) {
                    return {
                        status: 'error',
                        message: '用户表不存在或无法访问: ' + error.message,
                        fixable: true
                    };
                }
                
                if (!data || data.length === 0) {
                    return {
                        status: 'warning',
                        message: '用户表存在但为空',
                        fixable: true
                    };
                }
                
                return {
                    status: 'success',
                    message: '用户表正常'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '用户表测试异常: ' + error.message,
                    fixable: true
                };
            }
        }

        // 测试5：记录表
        async function testGameRecordsTable() {
            try {
                const { data, error } = await db.supabase.from('game_records').select('*').limit(1);
                
                if (error) {
                    return {
                        status: 'error',
                        message: '游戏记录表不存在或无法访问: ' + error.message,
                        fixable: true
                    };
                }
                
                if (!data || data.length === 0) {
                    return {
                        status: 'warning',
                        message: '游戏记录表存在但为空',
                        fixable: false
                    };
                }
                
                return {
                    status: 'success',
                    message: '游戏记录表正常'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '游戏记录表测试异常: ' + error.message,
                    fixable: true
                };
            }
        }

        // 测试6：管理员账号
        async function testAdminAccount() {
            try {
                const { data, error } = await db.supabase.from('admins')
                    .select('*')
                    .eq('username', 'admin')
                    .single();
                
                if (error) {
                    if (error.code === 'PGRST116') { // 找不到数据
                        return {
                            status: 'error',
                            message: '默认管理员账号不存在',
                            fixable: true
                        };
                    }
                    return {
                        status: 'error',
                        message: '查询管理员账号失败: ' + error.message,
                        fixable: true
                    };
                }
                
                if (!data.password && !data.password_hash) {
                    return {
                        status: 'warning',
                        message: '管理员账号存在但密码字段不完整',
                        fixable: true
                    };
                }
                
                return {
                    status: 'success',
                    message: '默认管理员账号存在'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '管理员账号测试异常: ' + error.message,
                    fixable: true
                };
            }
        }

        // 测试7：示例数据
        async function testSampleData() {
            try {
                // 检查示例游戏
                const { data: games, error: gamesError } = await db.supabase.from('games').select('*');
                
                if (gamesError) {
                    return {
                        status: 'error',
                        message: '查询游戏数据失败: ' + gamesError.message,
                        fixable: true
                    };
                }
                
                // 检查示例用户
                const { data: users, error: usersError } = await db.supabase.from('users').select('*');
                
                if (usersError) {
                    return {
                        status: 'error',
                        message: '查询用户数据失败: ' + usersError.message,
                        fixable: true
                    };
                }
                
                if (games.length === 0 && users.length === 0) {
                    return {
                        status: 'warning',
                        message: '系统中没有示例数据',
                        fixable: true
                    };
                }
                
                if (games.length === 0) {
                    return {
                        status: 'warning',
                        message: '没有示例游戏数据',
                        fixable: true
                    };
                }
                
                if (users.length === 0) {
                    return {
                        status: 'warning',
                        message: '没有示例用户数据',
                        fixable: true
                    };
                }
                
                return {
                    status: 'success',
                    message: '示例数据存在'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '示例数据测试异常: ' + error.message,
                    fixable: false
                };
            }
        }

        // 测试8：数据完整性
        async function testDataIntegrity() {
            try {
                // 检查记录表中的用户ID是否都存在于用户表中
                const { data: records, error: recordsError } = await db.supabase.from('game_records').select('user_id');
                
                if (recordsError || !records || records.length === 0) {
                    return {
                        status: 'warning',
                        message: '没有游戏记录数据，无法检查完整性',
                        fixable: false
                    };
                }
                
                const userIds = [...new Set(records.map(r => r.user_id))];
                
                for (const userId of userIds) {
                    const { data: user, error: userError } = await db.supabase.from('users')
                        .select('id')
                        .eq('id', userId)
                        .single();
                    
                    if (userError || !user) {
                        return {
                            status: 'warning',
                            message: `发现无效的用户ID: ${userId}`,
                            fixable: false
                        };
                    }
                }
                
                return {
                    status: 'success',
                    message: '数据完整性检查通过'
                };
            } catch (error) {
                return {
                    status: 'error',
                    message: '数据完整性测试异常: ' + error.message,
                    fixable: false
                };
            }
        }

        // 生成总结
        function generateSummary() {
            const summaryBox = document.getElementById('summaryBox');
            const summaryText = document.getElementById('summaryText');
            
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.status === 'success').length;
            const warningTests = testResults.filter(r => r.status === 'warning').length;
            const errorTests = testResults.filter(r => r.status === 'error').length;
            const fixableIssues = testResults.filter(r => r.fixable).length;
            
            let summary = `诊断完成。共测试 ${totalTests} 项，`;
            summary += `通过 ${passedTests} 项，`;
            summary += `警告 ${warningTests} 项，`;
            summary += `失败 ${errorTests} 项。`;
            
            if (errorTests === 0) {
                summary += ' 系统状态良好！';
                summaryBox.className = 'p-4 rounded-lg mb-6 status-good';
            } else if (fixableIssues > 0) {
                summary += ` 发现 ${fixableIssues} 个可修复的问题。`;
                summaryBox.className = 'p-4 rounded-lg mb-6 status-warning';
            } else {
                summary += ' 建议重新初始化数据库。';
                summaryBox.className = 'p-4 rounded-lg mb-6 status-error';
            }
            
            summaryText.textContent = summary;
        }

        // 更新按钮状态
        function updateButtonStates() {
            const hasErrors = testResults.some(r => r.status === 'error');
            const hasFixableIssues = testResults.some(r => r.fixable);
            const allPassed = testResults.every(r => r.status === 'success');
            
            document.getElementById('fixAllBtn').disabled = !hasFixableIssues;
            document.getElementById('exportLogBtn').disabled = false;
            document.getElementById('retryBtn').disabled = false;
            document.getElementById('gotoInitBtn').disabled = !hasErrors;
            document.getElementById('gotoLoginBtn').disabled = !allPassed;
        }

        // 添加日志
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            if (type === 'error') icon = 'exclamation-circle';
            
            logEntry.innerHTML = `
                <span class="text-gray-400">[${timestamp}]</span>
                <i class="fa fa-${icon} mr-2"></i>
                ${message}
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // 重置UI
        function resetUI() {
            // 清空日志
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '';
            
            // 重置测试项目
            const testItems = document.querySelectorAll('.test-item');
            testItems.forEach(item => {
                item.classList.remove('passed', 'failed', 'warning');
                const statusIndicator = item.querySelector('.status-indicator');
                statusIndicator.innerHTML = '<i class="fa fa-circle-o-notch fa-spin text-white text-opacity-50"></i>';
                
                const existingMessage = item.querySelector('.test-message');
                if (existingMessage) {
                    existingMessage.remove();
                }
            });
            
            // 重置总结
            document.getElementById('summaryBox').className = 'p-4 rounded-lg mb-6 status-info';
            document.getElementById('summaryText').textContent = '正在运行诊断，请稍候...';
            
            // 禁用所有按钮
            document.getElementById('fixAllBtn').disabled = true;
            document.getElementById('exportLogBtn').disabled = true;
            document.getElementById('retryBtn').disabled = true;
            document.getElementById('gotoInitBtn').disabled = true;
            document.getElementById('gotoLoginBtn').disabled = true;
        }

        // 一键修复所有问题
        async function fixAllIssues() {
            addLog('开始修复所有可修复的问题...', 'info');
            
            // 这里可以添加修复逻辑
            // 目前建议用户前往初始化页面
            addLog('建议前往数据库初始化页面进行修复', 'warning');
            
            // 启用初始化按钮
            document.getElementById('gotoInitBtn').disabled = false;
        }

        // 导出日志
        function exportLog() {
            const logs = document.querySelectorAll('.log-entry');
            let logText = '数据库诊断日志\n';
            logText += '================\n\n';
            logText += `生成时间: ${new Date().toLocaleString()}\n\n`;
            
            logs.forEach(log => {
                logText += log.textContent + '\n';
            });
            
            const blob = new Blob([logText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `database_diagnostic_${new Date().toISOString().split('T')[0]}.txt`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addLog('日志导出成功', 'success');
        }
    </script>
</body>
</html>