<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能测试页面</title>
    <script src="config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>QR游戏系统 - 功能测试页面</h1>
    
    <div class="test-section">
        <h2>数据检查</h2>
        <button onclick="checkData()">检查Mock数据</button>
        <div id="dataResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>游戏管理功能测试</h2>
        <button onclick="testAddGame()">测试添加游戏</button>
        <button onclick="testEditGame()">测试编辑游戏</button>
        <div id="gameResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>用户管理功能测试</h2>
        <button onclick="testAddUser()">测试添加用户</button>
        <button onclick="testEditUser()">测试编辑用户</button>
        <div id="userResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>数据导出功能测试</h2>
        <button onclick="testExportCSV()">测试CSV导出</button>
        <div id="exportResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>功能访问</h2>
        <button onclick="goToAdmin()">管理员控制台</button>
        <button onclick="goToUser()">用户页面</button>
    </div>

    <script>
        function checkData() {
            const result = document.getElementById('dataResult');
            try {
                const gamesCount = mockGames.length;
                const usersCount = mockUsers.length;
                const recordsCount = mockRecords.length;
                
                result.innerHTML = `
                    <p class="success">✓ Mock数据加载成功！</p>
                    <p>游戏数量: ${gamesCount}</p>
                    <p>用户数量: ${usersCount}</p>
                    <p>记录数量: ${recordsCount}</p>
                `;
            } catch (error) {
                result.innerHTML = `<p class="error">✗ 数据加载失败: ${error.message}</p>`;
            }
        }
        
        function testAddGame() {
            const result = document.getElementById('gameResult');
            try {
                const newGame = {
                    id: 'GTEST',
                    name: '测试游戏',
                    booth_number: 'TEST01',
                    description: '这是一个测试游戏',
                    status: 'active',
                    plays: 0,
                    gifts: 0
                };
                
                mockGames.push(newGame);
                result.innerHTML = `<p class="success">✓ 成功添加测试游戏！当前游戏总数: ${mockGames.length}</p>`;
            } catch (error) {
                result.innerHTML = `<p class="error">✗ 添加游戏失败: ${error.message}</p>`;
            }
        }
        
        function testEditGame() {
            const result = document.getElementById('gameResult');
            try {
                if (mockGames.length > 0) {
                    mockGames[0].name = '已编辑的游戏';
                    result.innerHTML = `<p class="success">✓ 成功编辑第一个游戏！</p>`;
                } else {
                    result.innerHTML = `<p class="error">✗ 没有游戏可以编辑</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p class="error">✗ 编辑游戏失败: ${error.message}</p>`;
            }
        }
        
        function testAddUser() {
            const result = document.getElementById('userResult');
            try {
                const newUser = {
                    id: 'UTEST',
                    name: '测试用户',
                    group: '测试组',
                    plays: 0
                };
                
                mockUsers.push(newUser);
                result.innerHTML = `<p class="success">✓ 成功添加测试用户！当前用户总数: ${mockUsers.length}</p>`;
            } catch (error) {
                result.innerHTML = `<p class="error">✗ 添加用户失败: ${error.message}</p>`;
            }
        }
        
        function testEditUser() {
            const result = document.getElementById('userResult');
            try {
                if (mockUsers.length > 0) {
                    mockUsers[0].name = '已编辑的用户';
                    result.innerHTML = `<p class="success">✓ 成功编辑第一个用户！</p>`;
                } else {
                    result.innerHTML = `<p class="error">✗ 没有用户可以编辑</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p class="error">✗ 编辑用户失败: ${error.message}</p>`;
            }
        }
        
        function testExportCSV() {
            const result = document.getElementById('exportResult');
            try {
                const data = [{name: '测试', value: 123}];
                const headers = ['名称', '数值'];
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                link.href = url;
                link.download = 'test-export.csv';
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
                
                result.innerHTML = `<p class="success">✓ CSV导出功能正常！文件已下载</p>`;
            } catch (error) {
                result.innerHTML = `<p class="error">✗ CSV导出失败: ${error.message}</p>`;
            }
        }
        
        function goToAdmin() {
            window.location.href = 'admin-dashboard.html';
        }
        
        function goToUser() {
            window.location.href = 'user.html';
        }
        
        // 页面加载时自动检查数据
        window.onload = checkData;
    </script>
</body>
</html>