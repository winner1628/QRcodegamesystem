<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户登录 - QR游戏系统</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- QR Code.js -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#06b6d4',
                        light: '#f3f4f6',
                        dark: '#1f2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .bg-gradient-primary {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="w-full max-w-md">
        <!-- 登录卡片 -->
        <div class="bg-white rounded-lg card-shadow p-8">
            <!-- 标题 -->
            <div class="text-center mb-8">
                <div class="flex justify-center mb-4">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fa fa-qrcode text-primary text-4xl"></i>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">用户登录</h2>
                <p class="text-gray-500 mt-1">请扫描二维码或输入用户ID登录</p>
            </div>
            
            <!-- 登录选项卡 -->
            <div class="flex mb-6">
                <button id="tabQr" class="flex-1 py-2 text-center border-b-2 border-primary text-primary font-medium">
                    <i class="fa fa-qrcode mr-1"></i> 扫码登录
                </button>
                <button id="tabManual" class="flex-1 py-2 text-center border-b-2 border-gray-200 text-gray-500 font-medium">
                    <i class="fa fa-keyboard-o mr-1"></i> 手动登录
                </button>
            </div>
            
            <!-- 扫码登录 -->
            <div id="loginQr" class="space-y-6">
                <div class="text-center">
                    <p class="text-gray-600 mb-4">请使用管理员提供的二维码扫描登录</p>
                    <div class="bg-white p-4 border-2 border-dashed border-gray-300 rounded-lg inline-block">
                        <div id="qrCode" class="w-48 h-48 mx-auto"></div>
                    </div>
                    <p class="text-gray-500 text-sm mt-4">或请管理员扫描上方二维码</p>
                </div>
                
                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">
                            或者
                        </span>
                    </div>
                </div>
                
                <div>
                    <button id="showManualLogin" class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none">
                        <i class="fa fa-keyboard-o mr-2"></i> 手动输入用户ID
                    </button>
                </div>
            </div>
            
            <!-- 手动登录 -->
            <div id="loginManual" class="space-y-6 hidden">
                <div>
                    <label for="userId" class="block text-sm font-medium text-gray-700 mb-1">
                        用户ID
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                            <i class="fa fa-id-card"></i>
                        </span>
                        <input type="text" id="userId" name="userId" required
                               class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="请输入您的用户ID">
                    </div>
                </div>
                
                <div>
                    <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">
                        用户姓名
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                            <i class="fa fa-user"></i>
                        </span>
                        <input type="text" id="userName" name="userName" required
                               class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="请输入您的姓名">
                    </div>
                </div>
                
                <div>
                    <button id="manualLoginBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-primary hover:opacity-90 focus:outline-none">
                        <i class="fa fa-sign-in mr-2"></i> 登录
                    </button>
                </div>
                
                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">
                            或者
                        </span>
                    </div>
                </div>
                
                <div>
                    <button id="showQrLogin" class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none">
                        <i class="fa fa-qrcode mr-2"></i> 返回扫码登录
                    </button>
                </div>
            </div>
            
            <!-- 错误信息 -->
            <div id="errorMessage" class="mt-4 hidden">
                <div class="bg-red-50 border-l-4 border-red-500 p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fa fa-exclamation-circle text-red-500"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-red-700" id="errorText"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 返回首页 -->
        <div class="text-center mt-6">
            <a href="/index.html" class="text-gray-600 hover:text-primary transition-all-300">
                <i class="fa fa-arrow-left mr-1"></i> 返回首页
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化二维码
            const qrCodeContainer = document.getElementById('qrCode');
            const uniqueId = generateUniqueId();
            const qrData = `https://qr-game-system.vercel.app/user/auth?id=${uniqueId}`;
            
            QRCode.toCanvas(qrCodeContainer, qrData, {
                width: 192,
                margin: 1,
                color: {
                    dark: '#3b82f6',
                    light: '#ffffff'
                }
            }, function(error) {
                if (error) console.error(error);
                console.log('QR code generated');
            });
            
            // 选项卡切换
            const tabQr = document.getElementById('tabQr');
            const tabManual = document.getElementById('tabManual');
            const loginQr = document.getElementById('loginQr');
            const loginManual = document.getElementById('loginManual');
            
            tabQr.addEventListener('click', function() {
                tabQr.classList.add('border-primary', 'text-primary');
                tabQr.classList.remove('border-gray-200', 'text-gray-500');
                tabManual.classList.add('border-gray-200', 'text-gray-500');
                tabManual.classList.remove('border-primary', 'text-primary');
                loginQr.classList.remove('hidden');
                loginManual.classList.add('hidden');
            });
            
            tabManual.addEventListener('click', function() {
                tabManual.classList.add('border-primary', 'text-primary');
                tabManual.classList.remove('border-gray-200', 'text-gray-500');
                tabQr.classList.add('border-gray-200', 'text-gray-500');
                tabQr.classList.remove('border-primary', 'text-primary');
                loginManual.classList.remove('hidden');
                loginQr.classList.add('hidden');
            });
            
            // 显示手动登录
            document.getElementById('showManualLogin').addEventListener('click', function() {
                tabManual.click();
            });
            
            // 显示二维码登录
            document.getElementById('showQrLogin').addEventListener('click', function() {
                tabQr.click();
            });
            
            // 手动登录
            document.getElementById('manualLoginBtn').addEventListener('click', function() {
                const userId = document.getElementById('userId').value;
                const userName = document.getElementById('userName').value;
                const errorMessage = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');
                
                if (!userId || !userName) {
                    errorText.textContent = '请输入用户ID和姓名';
                    errorMessage.classList.remove('hidden');
                    return;
                }
                
                // 模拟登录验证 (实际应用中应该调用API)
                if (userId.startsWith('U') && userId.length >= 6) {
                    // 登录成功，保存用户信息并跳转到用户中心
                    localStorage.setItem('userLoggedIn', 'true');
                    localStorage.setItem('userId', userId);
                    localStorage.setItem('userName', userName);
                    window.location.href = '/user/dashboard.html';
                } else {
                    // 登录失败，显示错误信息
                    errorText.textContent = '用户ID格式不正确，请检查后重试';
                    errorMessage.classList.remove('hidden');
                    
                    // 3秒后自动隐藏错误信息
                    setTimeout(() => {
                        errorMessage.classList.add('hidden');
                    }, 3000);
                }
            });
            
            // 模拟二维码扫描检测
            simulateQrScanDetection(uniqueId);
        });
        
        // 生成唯一ID
        function generateUniqueId() {
            return 'QR' + Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // 模拟二维码扫描检测
        function simulateQrScanDetection(uniqueId) {
            // 实际应用中，这里应该是一个轮询API检查二维码是否被扫描
            // 这里仅作演示，3秒后模拟扫描成功
            setTimeout(() => {
                // 模拟扫描成功，自动填充用户信息并登录
                document.getElementById('userId').value = 'U10023';
                document.getElementById('userName').value = '张三';
                
                // 显示登录成功提示
                const errorMessage = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');
                errorMessage.classList.remove('hidden');
                errorMessage.classList.remove('bg-red-50', 'border-red-500');
                errorMessage.classList.add('bg-green-50', 'border-green-500');
                errorText.classList.remove('text-red-700');
                errorText.classList.add('text-green-700');
                errorText.innerHTML = '<i class="fa fa-check-circle mr-1"></i> 二维码扫描成功，正在登录...';
                
                // 2秒后跳转到用户中心
                setTimeout(() => {
                    localStorage.setItem('userLoggedIn', 'true');
                    localStorage.setItem('userId', 'U10023');
                    localStorage.setItem('userName', '张三');
                    window.location.href = '/user/dashboard.html';
                }, 2000);
            }, 3000);
        }
    </script>
</body>
</html>